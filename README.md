AstrBot 塔科夫三狗位置查询插件使用说明
📝 项目信息
插件名称： astrbot_plugin_goons
插件作者： 由 DeepSeek 根据用户需求编写
插件版本： v1.0.0
🎯 插件简介
这是一个专门为《逃离塔科夫》玩家设计的 AstrBot 插件，用于实时查询游戏中 Goons 小队（俗称"三狗"）的位置信息。插件会自动从官方数据源 eftarkov.com 获取最新数据，每 5 秒自动刷新，支持 PVP 和 PVE 双模式查询。

✨ 功能特色
🕵️ 实时监控
自动追踪三狗小队在塔科夫世界中的移动

实时显示位置变化，帮助玩家规划战术

🎮 双模式支持
PVP 模式：显示其他玩家上报的三狗位置

PVE 模式：显示离线模式中的三狗位置

两种模式独立显示，信息清晰明了

🗺️ 智能地图识别
支持中英文地图名称自动转换

内置地图别名系统，方便快速查询

自动匹配游戏内地图名称

⚡ 高性能设计
自动刷新：每 5 秒自动更新数据

本地缓存：查询时无需等待网络请求

异步处理：后台更新不阻塞机器人响应

📊 完善的状态管理
实时显示数据更新时间

统计插件运行状态

错误自动重试机制

📦 安装方法

1. 准备插件文件
   需要下载以下三个核心文件：

text
astrbot_plugin_goons/
├── main.py # 插件主程序（约 600 行代码）
├── metadata.yaml # 插件元数据
└── templates/
└── maps.txt # 地图别名配置文件 2. 创建插件目录
在 AstrBot 的插件目录中创建文件夹：

bash

# 进入 AstrBot 插件目录

cd /path/to/astrbot/plugins

# 创建插件文件夹

mkdir astrbot_plugin_goons

# 创建子目录

mkdir astrbot_plugin_goons/templates 3. 安装依赖
插件需要 httpx 库支持：

bash
pip install httpx>=0.24.0 4. 重启 AstrBot
重启 AstrBot 服务器，插件将自动加载。

🚀 使用命令
基础命令表
命令 别名 功能描述 示例
/三狗 /goons, /三狗位置 查询三狗最新位置 /三狗
/三狗地图 [地图名] /goons 地图, /地图三狗 查询指定地图记录 /三狗地图 海关
/刷新三狗 /刷新 goons, /更新三狗 手动强制刷新数据 /刷新三狗
/三狗状态 /goons 状态, /状态三狗 查看插件运行状态 /三狗状态
/三狗帮助 /goons 帮助, /三狗说明 显示帮助信息 /三狗帮助
详细使用示例

1. 查询所有最新位置
   text
   用户输入：/三狗

机器人回复：
🐺 Goons 小队（三狗）最新位置：

🎮 PVP 模式：
• 海关 - 01-08 20:23:16
• 森林 - 01-08 20:08:09

💀 PVE 模式：
• 海关 - 01-08 20:33:02

⏰ 数据更新时间：01-08 20:35:10（3 秒前）
🔄 自动刷新：每 5 秒
⚠️ 数据来源：eftarkov.com 2. 按地图查询
text
用户输入：/三狗地图 海关

机器人回复：
🗺️ 地图：海关

🎮 PVP 模式最新记录：
• 20:23:16
• 20:21:45
• 20:18:32

💀 PVE 模式最新记录：
• 20:33:02
• 20:31:22
• 20:29:31

📊 统计：PVP 记录 15 条，PVE 记录 20 条
⏰ 数据更新时间：20:35:10（3 秒前） 3. 查看插件状态
text
用户输入：/三狗状态

机器人回复：
📊 三狗位置查询插件状态：

🔄 自动刷新间隔：5 秒
📁 数据记录：PVP 15 条，PVE 20 条
⏰ 最后更新：2024-01-08 20:35:10（3 秒前）
📈 统计信息：
• 成功获取：156 次
• 失败次数：3 次
• 最后成功：3 秒前
✅ 自动刷新：运行中
🗺️ 地图别名：已加载 9 个
🗺️ 支持的地图与别名
完整地图列表
游戏内名称 中文名称 支持别名
Customs / 海关 海关 customs, hg, 海关地图
Woods / 森林 森林 woods, sl, 树林, 森林地图
Interchange / 立交桥 立交桥 interchange, ljq, 商场, 立交桥地图
Shoreline / 海岸线 海岸线 shoreline, hx, 疗养院, 海滨
Lighthouse / 灯塔 灯塔 lighthouse, dt, 灯塔地图
Streets of Tarkov / 街区 街区 streets, jq, 街道, 街区地图
Factory / 工厂 工厂 factory, gc, 工厂地图
Reserve / 储备站 储备站 reserve, cbz, 军事基地
The Lab / 实验室 实验室 lab, sys, 实验室地图
别名查询示例
text
/三狗地图 hg # 查询海关
/三狗地图 customs # 同样查询海关
/三狗地图 海关 # 中文查询
/goons 地图 woods # 英文查询森林
/三狗地图 sl # 使用缩写
⚙️ 配置文件说明
maps.txt 配置文件
插件首次运行时会自动在 data/astrbot_plugin_goons/ 目录下创建 maps.txt 文件。

文件格式：

txt

# 地图别名配置文件

# 格式：显示名称|别名 1,别名 2,别名 3

# 显示名称会作为查询结果显示

海关|customs, hg, 海关地图, 关海
森林|woods, sl, 树林, 森林地图, 林森
立交桥|interchange, ljq, 商场, 立交桥地图
海岸线|shoreline, hx, 疗养院, 海滨, 海岸
灯塔|lighthouse, dt, 灯塔地图, 灯塔图
自定义方法：

找到文件：astrbot/data/astrbot_plugin_goons/maps.txt

按格式添加新的别名

保存文件

无需重启，插件会自动重新加载配置

🔧 技术特性

1. 自动刷新机制
   频率：每 5 秒刷新一次

方式：异步后台任务

错误处理：网络异常时自动重试

资源优化：避免频繁请求，智能缓存

2. 数据缓存系统
   内存缓存：最新数据保存在内存中

查询优化：直接从缓存返回结果

过期机制：5 秒自动更新缓存

3. 错误处理
   网络错误：自动重试，记录错误时间

API 异常：优雅降级，保持旧数据

数据解析：容错处理，避免崩溃

4. 性能优化
   异步 IO：使用 httpx 异步请求

避免阻塞：后台刷新不影响主线程

内存管理：定期清理旧数据

🛠️ 自定义设置
修改刷新频率
如果需要调整数据刷新频率，可以修改 main.py 中的配置：

python

# 找到这行代码（大约第 22 行）

AUTO_REFRESH_INTERVAL = 5 # 每 5 秒刷新

# 修改为其他值，如：

AUTO_REFRESH_INTERVAL = 10 # 每 10 秒刷新
AUTO_REFRESH_INTERVAL = 30 # 每 30 秒刷新
推荐设置：

5 秒：追求最高实时性

10 秒：平衡性能和实时性

30 秒：减少服务器压力

添加自定义别名
编辑 maps.txt 文件，按以下格式添加：

txt

# 添加新的地图别名

街区|streets, jq, 街道, street, 街

# 或者修改现有别名

海关|customs, hg, 海关地图, hǎiguān, HG
